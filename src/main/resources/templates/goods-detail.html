<!DOCTYPE html>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title th:text="${detail.goodsDetail.goodsTitle}"></title>
        <link th:href="@{/lib/css/element-ui.css}" rel="stylesheet" />
        <style>
            body{
                margin: 0;
            }
            #app {
                width: 1000px;
                margin: 10px auto 0 auto;
            }
            .card-img{
                border: 1px #8c939d solid;
                box-shadow: #8c939d;
                display: inline-block;
                margin: 0 5px;
            }
            .card-img img{
                width: 400px;
            }
            .card-content .card-title{
                font-size: 16px;
                color: #2b2c2d;
            }
            .card-content .card-desc{
                font-size: 20px;
                color: #5b5b5c;
            }
        </style>
    </head>
    <body>
        <div th:insert="~{header}"></div>
        <div id="app">
            <div class="card-wrapper" th:object="${detail}">
                <el-row>
                    <el-col :span="12">
                        <div class="card-img">
                            <img th:src="*{goodsDetail.goodsImg}">
                        </div>
                    </el-col>
                    <el-col :span="12">
                        <div class="card-content">
                            <span class="card-title" th:text="*{goodsDetail.goodsName}"></span>
                            <div class="card-desc">
                                <span th:title="*{goodsDetail.goodsTitle}" style="display: block" th:text="*{goodsDetail.goodsTitle}"></span>
                            </div>
                            <span style="border:1px solid #e1251b;background: #e1251b;color: #f1f1ef">
                                <span style="color: #f1f1ef" class="el-icon-">
                                    <i style="font-size: 10px">秒杀</i>
                                    <span th:text="'￥'+*{goodsDetail.miaoshaPrice}"></span>
                                </span>
                                <span style="color:#2b2c2d;background:#ffffff;text-decoration: line-through;" th:text="'￥'+*{goodsDetail.goodsPrice}"></span>
                            </span>
                            <br/><br>
                            <div>
                                <span th:if="${detail.miaoshaStatus}==0">
                                    距离秒杀开始还剩
                                    <span v-text="remainTime" style="color: #e1251b">{{remainTime}}</span>
                                </span>
                                <span th:if="${detail.miaoshaStatus}==1">
                                    距离秒杀结束还剩
                                     <span v-text="remainTime" style="color: #e1251b">{{remainTime}}</span>
                                </span>
                                <span th:if="${detail.miaoshaStatus}==2">
                                    <span style="color: #e1251b">来晚了哦，秒杀已结束</span>
                                </span>
                            </div>
                            <el-button type="danger" v-on:click="secondsKill" th:disabled="${detail.miaoshaStatus}!=1">立即秒杀</el-button>
                        </div>
                    </el-col>
                </el-row>
            </div>
        </div>
        <div th:insert="~{footer}"></div>
    </body>
    <script th:src="@{/lib/js/axios.min.js}"></script>
    <script th:src="@{/lib/js/vue.js}"></script>
    <script th:src="@{/lib/js/element-ui.js}"></script>

    <script th:inline="javascript">
        //<![CDATA[
        new Vue({
            el: '#app',
            data: function(){
                return {
                    goodsId:[[${detail.goodsDetail.goodsId}]],
                    remainSeconds:[[${detail.remainSeconds}]],
                    remainTime:'00天00时00分00秒',
                    timer:null
                }
            },
            methods: {
                addZero:function(i) {
                    return i < 10 ? "0" + i: i + "";
                },
                countDown:function () {
                    var d = parseInt(this.remainSeconds / (24*60*60))
                    var h = parseInt(this.remainSeconds / (60 * 60) % 24);
                    var m = parseInt(this.remainSeconds / 60 % 60);
                    var s = parseInt(this.remainSeconds % 60);
                    d = this.addZero(d)
                    h = this.addZero(h);
                    m = this.addZero(m);
                    s = this.addZero(s);
                    this.remainTime = d+'天'+h+'时'+m+'分'+s+'秒';
                    this.remainSeconds-=1;
                    if(this.remainSeconds === 0) {
                        clearInterval(this.timer);
                    }
                },
                secondsKill:function (){
                    let param = "goodsId="+this.goodsId
                    axios.post("/secondsKill",param)
                        .then(function (response) {
                            let data = response.data;
                            if (data && data.code === 200) {
                                window.location.href = "/order?id="+data.data.id
                            }else {
                                alert(data.msg)
                            }
                        })
                        .catch(function (error) {
                            if (error.response) {
                                if(error.response.status === 403){
                                    alert("请先登录！")
                                    window.location.href="/login"
                                }
                            }else {
                                alert("秒杀失败，请稍后重试！")
                            }
                        });
                }
            },
            mounted:function () {
                this.timer = setInterval(this.countDown, 1000);
            }
        })
        //]]>
    </script>

</html>